<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Copy-Paste JS Code</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Albert+Sans:ital,wght@0,100..900;1,100..900&family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
</head>

<style>
    body {
        font-family: "EB Garamond" !important;
    }
</style>

<body>
<h2>Copy the code below to paste into Cloudflare Workers.</h2>
<p>This code is for the Workers AI worker. Copy-and-paste this whole block of code into the code editor, replacing any existing code.</p>
<pre>
    export default {
    async fetch(request, env) {
      const API_KEY = env.API_KEY;
      const auth = request.headers.get("Authorization");

      if (auth !== `Bearer ${API_KEY}`) {
        return new Response(JSON.stringify({ error: "Unauthorized" }), { status: 401 });
      }

      if (request.method !== "POST") {
        return new Response(JSON.stringify({ error: "Only POST allowed" }), { status: 405 });
      }

      const { prompt } = await request.json();
      if (!prompt) {
        return new Response(JSON.stringify({ error: "Prompt is required" }), { status: 400 });
      }

      try {
        const result = await env.AI.run("@cf/black-forest-labs/flux-1-schnell", { prompt });

        const binaryString = atob(result.image);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }

        return new Response(bytes, {
          headers: { "Content-Type": "image/jpeg" },
        });
      } catch (err) {
        return new Response(JSON.stringify({ error: "Failed to generate image", details: err.message }), {
          status: 500,
        });
      }
    },
  };

</pre>
</body>
</html>